---
import Plain from "../layouts/Plain.astro";
import { servicePriceFormatted } from '../lib/helpers';
import PageHeader from '../components/PageHeader.astro';

export interface Props {
	content: {
		title: string;
		description: string;
		sku: string;
		price: number;
		term: string;
		included?: string[];
		subnav?: string[];
	}
}

const { content: { 
	price, 
	term, 
	sku, 
	title, 
	description,
	included,
	subnav,
} } = Astro.props as Props;

const files = await Astro.glob("../pages/wordpress-services/*.md");
const services = included && files.filter(i => included.includes(i.frontmatter.sku));

const headerLink = ( heading ) => {
	return '#' + heading.toLowerCase().replaceAll(',', '').replaceAll(' ', '-');
}
---
<Plain>
	<div class="wrapper">
		<a href="/wordpress-services" class="uppercase text-xs text-slate-600 tracking-widest font-heading">‚Üê WordPress Services</a>
	</div>		  
	<article>
	<PageHeader>
		<h1 class="text-h1 font-heading font-bold leading-tight">{title}</h1>
		{ description && 
			<p class="lead font-heading font-light">{description}</p>
		}
		<img slot="graphic" class="max-w-full max-h-96" src={`/assets/svgs/services/${sku}.svg`} />
	</PageHeader>
	<div class="wrapper flex justify-between gap-12 mt-12">
		<div class="max-w-xl">
			{ services &&
			<div class="mb-12">
					<h2 class="font-heading h4 uppercase text-slate-300 tracking-widest font-semibold">Also Included</h2>
					<div class="border-2 border-slate-200 p-3 rounded-lg shadow-md ">
						{ services.map(service => 
							<a href={service.url} class="p-8 grid grid-cols-2 text-slate-700 odd:bg-slate-50 rounded-md hover:bg-slate-100">
								<span class="flex flex-col">
									<h3 class="font-heading">{service.frontmatter.title}</h3>
									<p class="text-slate-400">{servicePriceFormatted(service.frontmatter.price, service.frontmatter.term)} value</p>
									<p class="text-link mt-auto">Learn More</p>
								</span>
								<p class="text-sm">
									{service.frontmatter.description}
								</p>
							</a>
						) }
					</div>
				</div>
				}
					<div class="prose mt-12 prose-headings:font-heading prose-headings:text-slate-700 prose-headings:uppercase prose-a:text-brand-midblue">
						<slot></slot>
					</div>
				</div>
				<div class="w-96">
					<div class="bg-slate-100 ring ring-white rounded-lg p-4 sticky top-8 shadow-xl">
					<a href={'/contact?service=' + encodeURIComponent(title)} class="px-6 py-4 bg-brand-action text-white rounded-full w-full block text-center font-heading uppercase font-semibold tracking-widest">
						Sign Up Now
					</a>
					<p class="text-lead font-heading my-8 text-center">
						{servicePriceFormatted(price, term)}
					</p>
					{ subnav && 
					<nav class="flex flex-col text-xs">
						{subnav.map(i => 
							<a class="block odd:bg-slate-200 hover:bg-slate-300 focus:bg-slate-300 rounded px-4 py-3 uppercase tracking-wider font-heading text-slate-600 hover:text-slate-700" href={headerLink(i)}>{i}</a>
						)}
					</nav>
					}
				</div>
			</div>
		</div>
	</article>
</Plain>